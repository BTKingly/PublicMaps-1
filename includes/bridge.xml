<map proto="1.4.2">
<!-- [#####|#####] -->
<!-- Bridge gamemode include file -->
<!-- Created by zzuf -->
<!-- Version 2023.06.26-1 -->
<gamemode>bridge</gamemode>
<respawn auto="true" delay="0s"/>
<modifybowprojectile pickup-filter="never"/>
<time result="score" show="false">15m</time>
<constants> <!-- Default values - Can be overriden by an individual map's code -->
    <!-- Map -->
    <constant id="map-origin">0.5,0,0.5</constant>
    <constant id="void-plane">-5</constant>
    <!-- Match -->
    <constant id="score-limit">5</constant>
    <constant id="mercy-limit">-1</constant>
    <constant id="pre-round-time">5s</constant>
    <!-- Teams (placeholders) -->
    <constant id="team-one-spawn">0.5,0,0.5</constant>
    <constant id="team-one-yaw">-90</constant>
    <constant id="team-one-pitch">0</constant>
    <constant id="team-two-spawn">0.5,0,0.5</constant>
    <constant id="team-two-yaw">90</constant>
    <constant id="team-two-pitch">0</constant>
</constants>
<broadcasts>
    <alert after="10m">`7If neither team has won by then, the match will end in `c`l5 minutes`7!</alert>
    <alert after="13m">`7If neither team has won by then, the match will end in `c`l2 minutes`7!</alert>
    <alert after="14m">`7If neither team has won by then, the match will end in `c`l1 minute`7!</alert>
    <alert after="14m30s">`7If neither team has won by then, the match will end in `c`l30 seconds`7!</alert>
    <alert after="14m50s">`7If neither team has won by then, the match will end in `4`l10 seconds`7!</alert>
</broadcasts>
<spawns>
    <spawn team="team-one" kit="spawn-kit" yaw="${team-one-yaw}" pitch="${team-one-pitch}" region="team-one-spawn-point"/>
    <spawn team="team-two" kit="spawn-kit" yaw="${team-two-yaw}" pitch="${team-two-pitch}" region="team-two-spawn-point"/>
</spawns>
<kits>
    <kit id="spawn-kit">
        <clear/>
        <item slot="0" material="iron sword" unbreakable="true"/>
        <item slot="1" material="bow" unbreakable="true" lore="`e⚠ `cYou can only hold `f1`c arrow at a time!|`9ⓘ `7Get a new one `f3.5 seconds `7after shooting!"/>
        <item slot="2" material="diamond pickaxe" enchantment="dig speed:2" unbreakable="true"/>
        <item slot="3" material="stained clay" team-color="true" amount="64"/>
        <item slot="4" material="stained clay" team-color="true" amount="64"/>
        <item slot="5" material="golden apple" amount="8" consumable="bridge-apple" prevent-sharing="true" lore="`9ⓘ `7Instantly restores to `c20 HP`7!|`9ⓘ `7Grants `eAbsorption`7 for `f1 minute`7!"/>
        <effect duration="oo">invisibility</effect>
        <effect duration="oo" amplifier="255">slow_digging</effect>
        <effect duration="2s" amplifier="255">resistance</effect>
        <health>20</health>
        <action>
            <kit id="arrow-kit"/>
        </action>
    </kit>
    <kit id="armor-kit">
        <chestplate material="leather chestplate" team-color="true" unbreakable="true" prevent-sharing="true"/>
        <leggings material="leather leggings" team-color="true" unbreakable="true" prevent-sharing="true"/>
        <boots material="leather boots" team-color="true" unbreakable="true" prevent-sharing="true"/>
    </kit>
    <kit id="remove-effects-kit" force="true">
        <effect duration="0">invisibility</effect>
        <effect duration="0">slow_digging</effect>
    </kit>
    <kit id="pre-round-kit" force="true">
        <effect duration="oo">invisibility</effect>
        <effect duration="oo" amplifier="255">slow_digging</effect>
    </kit>
    <kit id="arrow-kit">
        <item slot="8" material="arrow" lore="`e⚠ `cYou can only hold `f1`c arrow at a time!|`9ⓘ `7Get a new one `f3.5 seconds `7after shooting!"/>
        <action>
            <message actionbar="`a`lARROW READY!"/>
        </action>
    </kit>
    <kit id="absorption-kit" force="true">
        <effect duration="1m">absorption</effect>
    </kit>
    <kit id="absorption-reset-kit" force="true">
        <effect duration="0" amplifier="1">absorption</effect>
    </kit>
    <kit id="bridge-apple-kit" force="true">
        <health>20</health>
        <action scope="player" filter="no-absorption">
            <kit id="absorption-kit"/>
        </action>
    </kit>
    <kit id="void-death" force="true">
        <clear effects="true" items="false" armor="false"/>
        <health>1</health>
    </kit>
    <give kit="spawn-kit" filter="during-buytime"/>
    <give kit="absorption-reset-kit" filter="on-buytime"/>
    <lend kit="pre-round-kit" filter="on-buytime"/>
    <give kit="armor-kit" filter="not-on-buytime"/>
    <give kit="remove-effects-kit" filter="not-on-buytime"/>
</kits>
<filters>
    <deny id="deny-participating">
        <participating/>
    </deny>
    <any id="some-blocks">
        <allow>
            <filter id="block-list"/>
        </allow>
        <deny>
            <participating/>
        </deny>
    </any>
    <all id="only-team-one">
        <team>team-one</team>
        <participating/>
    </all>
    <all id="only-team-two">
        <team>team-two</team>
        <participating/>
    </all>
    <all id="team-one-about-to-score">
        <team>team-one</team>
        <region id="team-two-big-scorebox"/>
        <variable var="can_score">1</variable>
        <match-running/>
        <alive/>
    </all>
    <all id="team-two-about-to-score">
        <team>team-two</team>
        <region id="team-one-big-scorebox"/>
        <variable var="can_score">1</variable>
        <match-running/>
        <alive/>
    </all>
    <all id="in-scorebox">
        <any>
            <all>
                <team>team-two</team>
                <region id="team-one-portal"/>
            </all>
            <all>
                <team>team-one</team>
                <region id="team-two-portal"/>
            </all>
        </any>
        <variable var="can_score">1</variable>
        <match-running/>
        <alive/>
        <participating/>
    </all>
    <variable id="player-scored" var="in_scorebox">1</variable>
    <all id="team-one-scored">
        <team>team-one</team>
        <region id="team-two-portal"/>
        <filter id="cant-score"/>
        <after duration="0.05" filter="player-scored"/>
        <match-running/>
        <alive/>
        <participating/>
    </all>
    <all id="team-two-scored">
        <team>team-two</team>
        <region id="team-one-portal"/>
        <filter id="cant-score"/>
        <after duration="0.05" filter="player-scored"/>
        <match-running/>
        <alive/>
        <participating/>
    </all>
    <variable id="round-0" var="round_status">0</variable>
    <variable id="round-1" var="round_status">1</variable>
    <variable id="cant-score" var="can_score">0</variable>
    <variable id="can-score" var="can_score">1</variable>
    <after id="after-round-1" duration="0.05" filter="round-1"/>
    <all id="during-buytime">
        <after duration="0.05" filter="on-buytime"/>
        <not>
            <region id="void"/>
        </not>
    </all>
    <variable id="round-2" var="round_status">2</variable>
    <any id="remove-entities">
        <entity>dropped item</entity>
        <entity>arrow</entity>
    </any>
    <all id="on-buytime">
        <variable var="buytime">1</variable>
        <alive/>
        <participating/>
    </all>
    <all id="not-on-buytime">
        <variable var="buytime">0</variable>
        <alive/>
        <participating/>
    </all>
    <after id="cage-time" message="`a» `fNext round begins in {0} `a«" duration="${pre-round-time}" filter="round-0"/>
    <all id="no-arrows">
        <not>
            <carrying ignore-metadata="true"><item material="arrow"/></carrying>
        </not>
        <participating/>
        <alive/>
    </all>
    <all id="1-arrow">
        <carrying ignore-metadata="true"><item material="arrow"/></carrying>
        <participating/>
    </all>
    <all id="more-than-1-arrow">
        <carrying ignore-metadata="true"><item material="arrow" amount="2"/></carrying>
        <participating/>
    </all>
    <after id="arrow-regen" duration="3.5s" filter="no-arrows"/>
    <not id="no-absorption">
        <effect>absorption</effect>
    </not>
    <time id="after-13m">13m</time>
    <time id="after-15m2s">15m2s</time>
    <after duration="2m" filter="after-13m">
        <message>`4» `fThe match will `cend`f in {0} `4«</message>
        <!-- <message>{"translate":"misc.timeRemaining"}</message> -->
    </after>
    <after duration="1s" filter="after-15m2s" message="`e`lOvertime"/> <!-- Only appears if the time limit has been cancelled via commands -->
</filters>
<consumables>
    <consumable id="bridge-apple" on="eat" override="true" action="bridge-apple-kit"/>
</consumables>
<variables>
    <variable id="can_score" scope="match" default="1"/>
    <variable id="in_scorebox" scope="match" default="0"/>
    <variable id="round_status" scope="match" default="2"/>
    <variable id="buytime" scope="match" default="0"/>
</variables>
<actions>
    <action id="increment-round" scope="player">
        <switch-scope outer="player" inner="match">
            <message text="`5# # # # # # # # # # # #"/>
            <message text="`5# #    `6» `6`lGOAL! `6«`5    # #"/>
            <message text="`5# # # # # # # # # # # #"/>
            <set var="in_scorebox" value="0"/>
            <set var="round_status" value="1"/>
            <set var="buytime" value="1"/>
            <fill region="cages" material="stained glass"/>
            <kill-entities filter="remove-entities"/>
            <message title="`f`lGOAL!" subtitle="`7The next round will begin shortly." fade-in="0.5" stay="1" fade-out="0.5"/>
        </switch-scope>
    </action>
    <action id="set-scorebox-variables" scope="player">
        <switch-scope outer="player" inner="match">
            <set var="can_score" value="0"/>
            <set var="in_scorebox" value="1"/>
        </switch-scope>
    </action>
    <action id="remove-cages" scope="match">
        <fill region="cages" material="air"/>
        <set var="can_score" value="1"/>
        <set var="buytime" value="0"/>
        <message title="`aGo!" fade-in="0.1" stay="0.5" fade-out="0.1"/>
        <switch-scope outer="match" inner="player">
            <replace-item>
                <find material="ink sack" damage="5" locked="true"/>
                <replace material="air"/>
            </replace-item>
        </switch-scope>
    </action>
    <action id="reset-counter" scope="match">
        <set var="round_status" value="0"/>
    </action>
    <action id="remove-arrow" scope="player">
        <replace-item>
            <find material="arrow"/>
            <replace material="air"/>
        </replace-item>
    </action>
    <action id="no-arrows-message" scope="player">
        <message text=" `e⚠ `cYou will receive an arrow in `e3.5`c seconds!" actionbar="`c`lNO ARROWS!"/>
    </action>
    <action id="1-arrow-message" scope="player">
        <message actionbar="`a`lARROW READY!"/>
    </action>
    <action id="give-arrow" scope="player">
        <kit id="arrow-kit"/>
        <message text=" `e⚠ `aYou got an arrow!"/>
    </action>
    <trigger filter="arrow-regen" action="give-arrow" scope="player"/>
    <trigger filter="team-one-scored" action="increment-round" scope="player"/>
    <trigger filter="team-two-scored" action="increment-round" scope="player"/>
    <trigger filter="in-scorebox" action="set-scorebox-variables" scope="player"/>
    <trigger filter="cage-time" action="remove-cages" scope="match"/>
    <trigger filter="after-round-1" action="reset-counter" scope="match"/>
    <trigger filter="more-than-1-arrow" action="remove-arrow" scope="player"/>
    <trigger filter="no-arrows" action="no-arrows-message" scope="player"/>
    <trigger filter="1-arrow" action="1-arrow-message" scope="player"/>
</actions>
<regions>
    <apply block-place="deny-participating" region="not-buildable">
        <message>{"translate":"map.protectPortal"}</message>
    </apply>
    <apply block-break="deny-participating" region="not-buildable" message="You may not break that block!"/>
    <apply block="some-blocks" message="You may not interact with that block!"/>
    <translate id="team-one-big-scorebox" offset="0,0.5,0"><region id="team-one-portal"/></translate>
    <translate id="team-two-big-scorebox" offset="0,0.5,0"><region id="team-two-portal"/></translate>
    <apply leave="not-on-buytime" region="cages" message="The next round will begin shortly!"/>
    <below id="void" y="${void-plane}"/>
    <apply kit="void-death" region="void"/>
    <!-- Spawn points -->
    <point id="team-one-spawn-point">${team-one-spawn}</point>
    <point id="team-two-spawn-point">${team-two-spawn}</point>
</regions>
<portals sound="true" observers="never">
    <!-- Falling on own team's portal -->
    <portal destination="team-one-spawn-point" filter="only-team-one" region="team-one-portal" yaw="@${team-one-yaw}" pitch="@${team-two-pitch}"/>
    <portal destination="team-two-spawn-point" filter="only-team-two" region="team-two-portal" yaw="@${team-two-yaw}" pitch="@${team-two-pitch}"/>
    <!-- Scoring -->
    <portal destination="team-one-spawn-point" forward="round-1" filter="only-team-one" yaw="@${team-one-yaw}" pitch="@${team-one-pitch}"/>
    <portal destination="team-two-spawn-point" forward="round-1" filter="only-team-two" yaw="@${team-two-yaw}" pitch="@${team-two-pitch}"/>
    <!-- Void -->
    <portal y="@-110" sound="false" region="void" observers="always"/>
</portals>
<score>
    <box points="1" region="team-one-portal" filter="team-two-about-to-score"/>
    <box points="1" region="team-two-portal" filter="team-one-about-to-score"/>
    <limit>${score-limit}</limit>
    <mercy>${mercy-limit}</mercy>
</score>
<gamerules>
    <naturalRegeneration>false</naturalRegeneration>
</gamerules>
<itemkeep>
    <item>iron sword</item>
    <item>bow</item>
    <item>diamond pickaxe</item>
    <item>golden apple</item>
</itemkeep>
<itemremove>
    <item>leather chestplate</item>
    <item>leather leggings</item>
    <item>leather boots</item>
    <item>arrow</item>
    <item>stained clay</item>
</itemremove>
<toolrepair>
    <tool>iron sword</tool>
    <tool>bow</tool>
    <tool>diamond pickaxe</tool>
</toolrepair>
<friendlyfirerefund>off</friendlyfirerefund>
<hunger>
    <depletion>off</depletion>
</hunger>
<disabledamage>
    <damage>fall</damage>
</disabledamage>
</map>
